<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>FCU Shop</title>
    <meta name="generator" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="base/jquery-ui.min.css" rel="stylesheet">
    <link href="Untitled1.css" rel="stylesheet">
    <link href="index.css" rel="stylesheet">
    <script src="jquery-1.12.4.min.js"></script>
    <script src="util.min.js"></script>
    <script src="carousel.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script>
$(document).ready(function()
{
   $("#Carousel1").bootstrapcarousel({interval:3000, pause: false});
   $("#Spinner1").spinner(
   {
      min: 1,
      max: 100,
      step: 1
   });
});
</script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid" id="top">
        <a class="navbar-brand" href="/home.html">FCU 租借網</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">



            <ul class="navbar-nav mb-2 mb-lg-0 d-flex">
                <li class="nav-item">
                    <a class="nav-link" href="/login.html">登入/註冊</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/addProduct.html">上架</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/viewproduct.html">購物車</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#"  role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        訂單
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="/shop.html">買家訂單</a></li>
                        <li><a class="dropdown-item" href="/order.html">賣家訂單</a></li>
                    </ul>
                </li>

            </ul>

            <!--<form class="d-flex">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>-->
        </div>
        <div id="welcome"></div>
    </div>
</nav>
<div id="wb_carouselGrid">
    <div id="carouselGrid">
        <div class="row">
            <div class="col-12 col-lg-6" id="picture">
                <!--
                <div id="wb_Carousel1">
                <div id="Carousel1" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                <li data-target="#Carousel1" data-slide-to="0" class="active"></li>
                <li data-target="#Carousel1" data-slide-to="1"></li>
                <li data-target="#Carousel1" data-slide-to="2"></li>
                </ol>
                <div class="carousel-inner">
                <div class="carousel-item frame-1 active">
                <div class="carousel-innerframe">
                </div>
                </div>
                <div class="carousel-item frame-2">
                <div class="carousel-innerframe">
                </div>
                </div>
                <div class="carousel-item frame-3">
                <div class="carousel-innerframe">
                </div>
                </div>
                </div>
                <a class="carousel-item-left carousel-control" href="#Carousel1" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span>
                </a>
                <a class="carousel-item-right carousel-control" href="#Carousel1" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span>
                </a>
                </div>
                </div>
                -->
            </div>
            <div class="col-12 col-lg-6">
                <div id="wb_Text4">
                </div>
                <div id="wb_BlockQuote">
                    <div id="BlockQuote-overlay"></div>
                    <div id="BlockQuote">
                        <div class="row">
                            <div class="col-1">
                                <div id="wb_Quote">
                                    <h4>商品介紹</h4><br>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="wb_LayoutGrid2">
                    <div class="LayoutGrid2">
                        <div class="row">
                            <div class="col-12 col-sm-10 col-md-10 col-lg-10 ">
                                <div id="wb_Text2">
                                    <span style="color:#000000;font-family:微軟正黑體;font-size:16px;">可租 </span>
                                    <span id="day"></span>
                                    <span style="color:#000000;font-family:微軟正黑體;font-size:16px;">天</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="wb_LayoutGrid3">
                    <div class="LayoutGrid3">
                        <div class="row">
                            <div class="col-12 col-sm-10 col-md-10 col-lg-10 ">
                                <div id="wb_Text5">
                                    <span style="color:#000000;font-family:微軟正黑體;font-size:16px;">要租</span>
                                    <input id="min2" style="background-color:white; " type="button" value="－" >
                                    <input id="num2" name="num" type="text" value="1" >
                                    <input id="add2" style="background-color:white; " type="button" value="＋" >
                                    <span style="color:#000000;font-family:微軟正黑體;font-size:16px;">天</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="wb_LayoutGrid3">
                    <div class="LayoutGrid3">
                        <div class="row">
                            <div class="col-12 col-sm-10 col-md-10 col-lg-10">
                                <div id="wb_Text1">
                                    <span style="color:#000000;font-family:微軟正黑體;font-size:16px;">數量</span>
                                    <input id="min" style="background-color:white; " type="button" value="－" >
                                    <input id="num" name="num" type="text" value="1" >
                                    <input id="add" style="background-color:white; " type="button" value="＋" >
                                    <span style="color:#000000;font-family:微軟正黑體;font-size:16px;">件</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-10 col-md-10 col-lg-10">
                    <button class="btn btn-outline-secondary" type="button" onclick="addorder();">加入購物車</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script>

var n=10;
var m=5;

function setTotal(){
		var t = $("#num");
		}

$(function(){ //這裡是加減按鈕都啟用的情況
	var t = $("#num");
	$("#add").click(function(){
		if(t.val()<m){
		t.val(parseInt(t.val())+1);
		}
		else{
		alert("一筆訂單最多五件喔！");
		}
		setTotal();
	})
	$("#min").click(function(){
		if(t.val()>1){
		t.val(parseInt(t.val())-1);
		}
		else{
		alert("至少購買一件喔！");
		}
		setTotal();
	})
});

function setTotal(){
		var t = $("#num2");
		}

$(function(){ //這裡是加減按鈕都啟用的情況
	var t = $("#num2");
	$("#add2").click(function(){
		if(t.val()<n){
		t.val(parseInt(t.val())+1);
		}
		else{
		alert("不能租太久喔！");
		}
		setTotal();
	})
	$("#min2").click(function(){
		if(t.val()>1){
		t.val(parseInt(t.val())-1);
		}
		else{
		alert("至少租一天喔！");
		}
		setTotal();
	})
});

function setCookie(name){
  let arr = document.cookie.match(new RegExp("(^| )" + name + "=([^;]*)(;|$)"));
  if (arr != null) return unescape(arr[2]);
  return null;
}
//刪除cookie
function delCookie(name){
  var exp = new Date();
  exp.setTime(exp.getTime() - 1);
  var cval = setCookie(name);
  if (cval != null)
    document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString()+";path=/";
}
function getCookie(name){
var cookies = document.cookie;
var list = cookies.split("; ");// 解析出名/值對列表
for(var i =0; i < list.length; i++){
var arr = list[i].split("=");// 解析出名和值
if(arr[0]== name)
return decodeURIComponent(arr[1]);// 對cookie值解碼
}
return"";
}
  $( document ).ready( function() {
    console.log( "ready!" );
    const id = getCookie('id');
    const name = getCookie('name');
    let html= '<h5> welcome   ' + name + '</h5>';
    $('#welcome').append(html);
    const productid = getCookie('productid');
    const url='../products/shop/'+productid;
    console.log(url);
    getProducts(url);
  });
    function addProducts(products) {
      for ( let product of products ) {
        let html = '<h1>'+product.name+'</h1>';
        $('#wb_Text4').append(html);
        html ='<img src="' + product.imageUrl + '" width="400" height="400" alt="' + product.name + '">';
        $('#picture').append(html);
        n= product.time;
        html = '<span style="color:#000000;font-family:微軟正黑體;font-size:13px;">'+ product.time +' </span>'
        $('#day').append(html);
        html = '<span style="color:#000000; font-family:微軟正黑體; font-size:16px;">' + product.description + '</span>';
        $('#wb_Quote').append(html);

        /*html += '<img src="' + product.imageUrl + '" class="card-img-top" alt="' + product.name + '">';
        html += '<div class="card-body">';
        html += '<h5 class="card-title">' + product.name + '</h5>';
        html += '<p class="card-text">'+'ID:' + product.id + '</p>';
        html += '<p class="card-text">' + product.description + '</p>';
        html += '<a href="#" class="btn btn-primary" onclick="handler(';
        html +=product.id+'); return false;">' + product.price + '</a>';
        html += '</div>';
        html += '</div>';
        */
      }
    }
    function getProducts(targetUrl) {
      // Using the core $.ajax() method
      $.ajax({
          // The URL for the request
          url: targetUrl,

          // Whether this is a POST or GET request
          type: "GET",

          // The type of data we expect back
          dataType : "json",
      })
        // Code to run if the request succeeds (is done);
        // The response is passed to the function
        .done(function( json ) {
          let products = json;
          addProducts(products);
        })
        // Code to run if the request fails; the raw request and
        // status codes are passed to the function
        .fail(function( xhr, status, errorThrown ) {
          console.log( "Sorry, there was a problem!" );
          console.log( "Error: " + errorThrown );
          console.log( "Status: " + status );
          console.dir( xhr );
        })
        // Code to run regardless of success or failure;
        .always(function( xhr, status ) {
          console.log( "The request is complete!" );
        });
    }



    function addorder(){
      const productid = getCookie('productid');
      const id = getCookie('id');
      const time = $("#num2").val();
      const count = $("#num").val();
      const url='../orders/'+productid+'/'+count+'/'+time+'/'+id+'/1';
      if(time<=0||time>n||count<=0||count>m){
      alert("數量或租借天數輸入錯誤")
      }
      else{
        console.log(url);
        addOrders(url);
        //可改用json或list格式回傳
        console.log("G");
        alert("成功加入購物車");
        return 0;
      }
    }

    function addOrders(targetUrl) {
      // Using the core $.ajax() method
      $.ajax({
          // The URL for the request
          url: targetUrl,

          // Whether this is a POST or GET request
          type: "GET",
          //盡量用post

          // The type of data we expect back
          dataType : "json",
      })

        // Code to run if the request fails; the raw request and
        // status codes are passed to the function
        .fail(function( xhr, status, errorThrown ) {
          console.log( "Sorry, there was a problem!" );
          console.log( "Error: " + errorThrown );
          console.log( "Status: " + status );
          console.dir( xhr );
        })
        // Code to run regardless of success or failure;
        .always(function( xhr, status ) {
          console.log( "The request is complete!" );
        });
    }


</script>
</body>
</html>